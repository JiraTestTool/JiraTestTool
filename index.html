<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <style>
      table, th, td {
          border: 1px solid black;
      }
    </style>
    <script src="node_modules/handsontable/dist/handsontable.full.min.js"></script>
    <link href="node_modules/handsontable/dist/handsontable.full.min.css" rel="stylesheet" media="screen">
  </head>
  <body>
    <h1>Hello World!</h1>
    <div>
       <!-- All of the Node.js APIs are available in this renderer process. -->
       We are using Node.js <script>document.write(process.versions.node)</script>,
       Chromium <script>document.write(process.versions.chrome)</script>,
       and Electron <script>document.write(process.versions.electron)</script>.
    </div>

    <script>
      // You can also require other files to run in this process
      require('./renderer.js')
    </script>

    <div><img src="https://gph.to/2lfKbGD" alt="very nice gif borat"></div>

    <br><br>
    <br><br>
    <br><br>


    <div class="login">
      username: <input id="userID" type="text" name="username"><br>
      password: <input id="passID" type="password" name="password"><br>
      <button value="login" onclick="login('userID','passID')">Login</button><br>
    </div>

    <br><br>

    <div class="after_login">

        <div class="issue">
          issue: <input type="text" name="issue"><br>
          <input type="button" value="get test steps"><br>
          code will talk to JIRA REST API and get test steps from the inputted issue#
        </div>
        <br><br>

        <div>imagine there is a spreadsheet here...<br>
            also imagine this spreadsheet is auto populated with JIRA test steps
        </div>

        <br><br>

        <div>
          <input id="search_field" type="search" placeholder="Search">
          <br><br>
          <div id="sheet"></div>
          <script type="text/javascript">
            var data = [
              ["Step", "Description", "Expected", "Notes"],
              ["Step 1", "do stuff", "expect this", "remember this important thing"],
              ["Step 2", "do stuff", "expect this", ""],
              ["Step 3", "do stuff", "expect this", ""],
              [,,,],
              [,,,],
              [,,,],
              [,,,],
              [,,,],
            ];

            var container = document.getElementById('sheet');
            var searchFiled = document.getElementById('search_field');
            var hot = new Handsontable(container, {
              data: data,
              width: 800,
              rowHeaders: true,
              colHeaders: [
                 'Step',
                 'Description',
                 'Expected',
                 'Notes',
              ],
              colWidths: [60, 200, 200, 200],
              /* true by default */
              allowInsertRow: true, /* even without contextMenu, can paste to expand spreadsheet */
              allowRemoveRow: true,
              /* false by default */
              search: true,
              contextMenu: true,
              mergeCells: true,
              manualRowResize: true,
              manualColumnResize: true,
              wordWrap: true,
              //manualRowMove: true,
              //manualColumnMove: true,
              /* a way to enforce 4 columns Step/Desc/Expect/Notes */
              allowInsertColumn: false,
              allowRemoveColumn: false
            });

            Handsontable.dom.addEvent(searchFiled, 'keyup', function (event) {
              var search = hot.getPlugin('search');
              var queryResult = search.query(this.value);

              console.log(queryResult);
              hot.render();
            });

          </script>
        </div>

        <br><br>

        <div class="update">
          <input type="button" value="update issue">
          <div>now code will talk to JIRA REST API and update the test case</div>
        </div>

        <br><br>


        <html lang="en" dir="ltr">
          <head>

            <meta charset="utf-8">
              <title>JSON Jenerator</title>
            <link rel="stylesheet" type="text/css" href="public/style.css">

          </head>
          <body>
            <h1>JSON Jenerator:</h1>
            <main>
              <div id="displayContainer">

              </div>
              <div id="buttonContainer">
                <button type="button" id="generate">Jenerate!</button>
              </div>

            </main>
          </body>
        </html>
    </div>
  </body>
  <footer>
    <script type="text/javascript">
        // gloabal variables
        process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';
        user = "";
        pass = "";
        jira = undefined;

        var JiraClient = require('jira-connector');

        function login(idUserInput, idPassInput) {
          user = document.getElementById(idUserInput).value;
          pass = document.getElementById(idPassInput).value;
          console.log("login success");
          jira = new JiraClient( {
              host: 'jira/jira',
              basic_auth: {
                  username: user,
                  password: pass
              }
          });
        }

        //======================================================

        function getMyself(){
          jira.myself.getMyself( {}, function(error, myself) {
              console.log(error);
              console.log(myself);
          });
        };


        function get_gold_25814() {
          jira.issue.getIssue({
              issueKey: 'GOLD-25814'
          }, function(error, issue) {
              console.log(error);
              console.log(issue.fields.summary);
              console.log(issue);
          });
        }
        //======================================================

        const jsonButton = document.querySelector('#generate');
        const buttonContainer = document.querySelector('#buttonContainer');
        const display = document.querySelector('#displayContainer');
        const collection = ["Another", "More", "Next", "Continue", "Keep going", "Click me", "A new one"];

        const generateJson = () => {
          const xhr = new XMLHttpRequest();
          xhr.responseType = 'json';

          xhr.onreadystatechange = () => {
            if (xhr.readyState === XMLHttpRequest.DONE) {
              display.innerHTML = `<pre>${JSON.stringify(xhr.response)}</pre>`;
              display.innerHTML += `<br><br>Hello ${xhr.response.displayName}!`;
              changeButton();
            }
          }
          xhr.open('GET', 'https://jira/jira/rest/api/latest/myself');
          console.log("attempt authorization with user: " + user);
          xhr.setRequestHeader("Authorization", "Basic " + btoa(user + ":" + pass));
          xhr.send();
        }

        const changeButton = () => {
          const newText = Math.floor(Math.random() * 7);
          jsonButton.innerHTML = `${collection[newText]}!`;
        }

        jsonButton.addEventListener('click', generateJson);
    </script>
  </footer>
</html>
